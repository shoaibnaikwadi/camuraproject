{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="container mt-5">
  <h2 class="text-center mb-4">ðŸ“¦ CCTV Packages</h2>

  <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
    {% for combo in combos %}
    <div class="col">
      <div class="card h-100 shadow-sm product-card">
        <!-- Badge -->
        {% if combo.is_best_seller %}
        <span class="badge bg-danger position-absolute top-0 start-0 m-2">Best Seller</span>
        {% elif combo.is_new %}
        <span class="badge bg-success position-absolute top-0 start-0 m-2">New</span>
        {% endif %}

        <!-- Product Image -->
        <a href="#" class="product-quickview" data-bs-toggle="modal" data-bs-target="#quickViewModal">
          <!-- {% if combo.image %}
          <img src="{{ combo.image.url }}" class="card-img-top product-img" alt="{{ combo.name }}">
          {% else %}
          <img src="{% static 'img/default-product.jpg' %}" class="card-img-top product-img" alt="No image">
          {% endif %} -->
          {% if combo.image %}
          <img src="{{ combo.image.url }}" class="card-img-top product-img" alt="{{ combo.name }}">
          {% else %}
          <img src="{% static 'img/default-product.jpg' %}" class="card-img-top product-img" alt="No image">
          {% endif %}

        </a>

        <div class="card-body d-flex flex-column">
          <!-- Product Name -->
          <h6 class="card-title">
            <a href="#" class="text-decoration-none text-dark product-quickview" data-bs-toggle="modal"
              data-bs-target="#quickViewModal">
              {{ combo.name }}
            </a>
          </h6>

          <!-- Price -->
          <h5 class="text-success mt-auto mb-2">â‚¹{{ combo.total_price|floatformat:2 }}</h5>

          <!-- Action Buttons -->
          <div class="d-flex gap-2 flex-wrap">
            <form action="{% url 'add_to_cart' combo.id %}" method="post" class="flex-fill">
              {% csrf_token %}
              <input type="hidden" name="qty" value="1">
              <button class="btn btn-success btn-sm w-100 add-to-cart-btn" type="submit">Add to Cart</button>
            </form>
            <form action="{% url 'buy_now' combo.id %}" method="post" class="flex-fill">
              {% csrf_token %}
              <input type="hidden" name="qty" value="1">
              <button class="btn btn-warning btn-sm w-100" type="submit">Buy Now</button>
            </form>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<!-- Quick View Carousel Modal -->
<div class="modal fade" id="quickViewModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Product Preview</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div id="quickViewCarousel" class="carousel slide" data-bs-ride="carousel">
          <div class="carousel-inner">
            {% for combo in combos %}
            <div class="carousel-item {% if forloop.first %}active{% endif %}">
              <div class="row">
                <div class="col-md-6 text-center">
                  {% if combo.image %}
                  <img src="{{ combo.image.url }}" class="img-fluid" alt="{{ combo.name }}">
                  {% else %}
                  <img src="{% static 'img/default-product.jpg' %}" class="img-fluid" alt="No image">
                  {% endif %}
                </div>
                <div class="col-md-6">
                  <h5>{{ combo.name }}</h5>
                  <p>
                    {{ combo.camera_qty }} Ã— {{ combo.camera.get_camera_type_display }}<br>
                    {{ combo.dvr.get_resolution_display }} {{ combo.dvr.get_channels_display }}<br>
                    Cable: {{ combo.cable.get_length_display }}<br>
                    Power: {{ combo.power.get_range_slug_display }}
                  </p>
                  <h4 class="text-success">â‚¹{{ combo.total_price|floatformat:2 }}</h4>
                  <div class="d-flex gap-2 mt-3">
                    <form action="{% url 'add_to_cart' combo.id %}" method="post">
                      {% csrf_token %}
                      <input type="hidden" name="qty" value="1">
                      <button class="btn btn-success">Add to Cart</button>
                    </form>
                    <form action="{% url 'buy_now' combo.id %}" method="post">
                      {% csrf_token %}
                      <input type="hidden" name="qty" value="1">
                      <button class="btn btn-warning">Buy Now</button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#quickViewCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#quickViewCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Styles -->
<style>
  .product-card {
    position: relative;
    transition: transform 0.3s, box-shadow 0.3s;
  }

  .product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 25px rgba(0, 0, 0, 0.2);
  }

  .product-img {
    height: 180px;
    object-fit: cover;
    cursor: pointer;
  }

  .add-to-cart-btn {
    transition: all 0.3s;
  }

  .add-to-cart-btn:active {
    transform: scale(0.95);
  }
</style>

{% endblock %}